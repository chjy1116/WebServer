<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.ac.hansung.maldives.web.dao2.IbcfMapper">
	<select id="selectStoresByUserIdx" resultType="Store" parameterType="Long">
		SELECT *
		FROM store
		WHERE store_idx in (
			SELECT rec1 as store_idx
			FROM evaluation JOIN position ON evaluation.position_idx = position.position_idx
							JOIN ibcf ON position.store_idx = ibcf.row_names
			WHERE user_idx = #{userIdx}
							
			UNION ALL
		
			SELECT rec2 as store_idx
			FROM evaluation JOIN position ON evaluation.position_idx = position.position_idx
							JOIN ibcf ON position.store_idx = ibcf.row_names
			WHERE user_idx = #{userIdx}
							
			UNION ALL
		
			SELECT rec3 as store_idx
			FROM evaluation JOIN position ON evaluation.position_idx = position.position_idx
							JOIN ibcf ON position.store_idx = ibcf.row_names
			WHERE user_idx = #{userIdx}
			
			UNION ALL
		
			SELECT rec4 as store_idx
			FROM evaluation JOIN position ON evaluation.position_idx = position.position_idx
							JOIN ibcf ON position.store_idx = ibcf.row_names
			WHERE user_idx = #{userIdx}
			
			UNION ALL
		
			SELECT rec5 as store_idx
			FROM evaluation JOIN position ON evaluation.position_idx = position.position_idx
							JOIN ibcf ON position.store_idx = ibcf.row_names
			WHERE user_idx = #{userIdx}
		)
	</select>
</mapper>